<ion-header>
  <app-toolbar-back
    [title]="'Personal details'"
    [navigation]="'/secure/tabs/profile'"
  ></app-toolbar-back>
</ion-header>

<ion-content [fullscreen]="true" class="profile-details personal-details-page">
  @if (loading() || !personalDetails()) {
  <div class="details-inner">
    <section class="form-card">
      <div class="section-header">
        <h2>
          <ion-skeleton-text
            animated
            style="width: 160px; height: 20px"
          ></ion-skeleton-text>
        </h2>
      </div>

      <ion-list lines="none" class="form-list">
        @for (i of [1,2,3,4]; track i) {
        <ion-item class="input-item ion-margin-bottom">
          <div style="width: 100%; margin-top: 4px">
            <ion-skeleton-text
              animated
              style="width: 100%; height: 40px; border-radius: 12px"
            ></ion-skeleton-text>
          </div>
        </ion-item>
        }
      </ion-list>
    </section>

    <div class="bottom-spacer" aria-hidden="true"></div>
  </div>
  } @else {
  <div class="details-inner">
    <form [formGroup]="form" (ngSubmit)="onSave()">
      <section class="form-card">
        <div class="section-header">
          <h2 class="ion-padding-bottom">Personal details</h2>
        </div>

        <ion-list lines="none" class="form-list">
          <label class="field-label ion-padding-bottom" for="pd-first-name">
            First name
          </label>
          <ion-item
            class="input-item ion-margin-bottom"
            [class.is-invalid]="
              form.get('firstName')?.invalid &&
              form.get('firstName')?.touched
            "
          >
            <ion-input
              id="pd-first-name"
              formControlName="firstName"
              placeholder="Enter first name"
              autocapitalize="words"
            ></ion-input>
          </ion-item>
          @if (form.get('firstName')?.invalid && form.get('firstName')?.touched)
          {
          <div class="error">First name is required (max 50 chars).</div>
          }
          <label class="field-label ion-padding-bottom" for="pd-last-name">
            Last name
          </label>
          <ion-item
            class="input-item ion-margin-bottom"
            [class.is-invalid]="
              form.get('lastName')?.invalid &&
              form.get('lastName')?.touched
            "
          >
            <ion-input
              id="pd-last-name"
              formControlName="lastName"
              placeholder="Enter last name"
              autocapitalize="words"
            ></ion-input>
          </ion-item>
          @if (form.get('lastName')?.invalid && form.get('lastName')?.touched) {
          <div class="error">Last name is required (max 50 chars).</div>
          }

          <label class="field-label ion-padding-bottom" for="pd-phone-local">
            Phone number
          </label>
          <ion-grid class="phone-grid">
            <ion-row class="ion-align-items-stretch">
              <ion-col
                class="ion-no-padding"
                size="4"
                sizeSm="5"
                sizeMd="4"
                sizeLg="4"
              >
                <ion-item
                  class="input-item input-item-country ion-margin-bottom"
                  [class.is-invalid]="
                    form.get('countryIso2')?.invalid &&
                    form.get('countryIso2')?.touched
                  "
                >
                  <ion-select
                    formControlName="countryIso2"
                    interface="action-sheet"
                    aria-label="Select country calling code"
                    placeholder="Country"
                    [selectedText]="selectedDialText"
                    (ionChange)="onCountryChange($event.detail.value)"
                  >
                    @for (c of countries; track c.iso2) {
                    <ion-select-option [value]="c.iso2">
                      {{ c.flag }}&nbsp;{{ c.dialCode }} — {{ c.name }}
                    </ion-select-option>
                    }
                  </ion-select>
                </ion-item>
              </ion-col>

              <ion-col
                class="ion-no-padding"
                size="8"
                sizeSm="7"
                sizeMd="8"
                sizeLg="8"
              >
                <ion-item
                  class="input-item ion-margin-bottom"
                  [class.is-invalid]="
                    form.get('phoneLocal')?.invalid &&
                    form.get('phoneLocal')?.touched
                  "
                >
                  <ion-input
                    id="pd-phone-local"
                    formControlName="phoneLocal"
                    type="tel"
                    inputmode="tel"
                    placeholder="Enter phone number"
                  ></ion-input>
                </ion-item>
                @if (form.get('phoneLocal')?.invalid &&
                form.get('phoneLocal')?.touched) {
                <div class="error">Please enter digits only (6–15).</div>
                }
              </ion-col>
            </ion-row>
          </ion-grid>
          <label class="field-label ion-padding-bottom" for="pd-sex">
            Sex
          </label>
          <ion-item
            class="input-item ion-margin-bottom"
            [class.is-invalid]="
              form.get('sex')?.invalid && form.get('sex')?.touched
            "
          >
            <ion-select
              id="pd-sex"
              formControlName="sex"
              interface="popover"
              justify="start"
              aria-label="Sex"
              placeholder="Select sex"
            >
              @for (opt of sexOptions; track opt) {
              <ion-select-option [value]="opt">{{ opt }}</ion-select-option>
              }
            </ion-select>
          </ion-item>
          @if (form.get('sex')?.invalid && form.get('sex')?.touched) {
          <div class="error">Please select your sex.</div>
          }
        </ion-list>
      </section>

      <div class="bottom-spacer" aria-hidden="true"></div>
    </form>
  </div>
  }
</ion-content>

<ion-footer class="ion-padding ion-no-border">
  <ion-toolbar>
    <ion-button
      type="submit"
      expand="block"
      color="primary"
      [disabled]="disableSave()"
      (click)="onSave()"
    >
      Save changes
    </ion-button>
  </ion-toolbar>
</ion-footer>
