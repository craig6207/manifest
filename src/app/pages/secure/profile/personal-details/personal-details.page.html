<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/secure/tabs/profile"></ion-back-button>
    </ion-buttons>

    <ion-title>Personal Details</ion-title>

    <ion-buttons slot="end">
      <ion-button
        (click)="openEdit()"
        aria-label="Edit personal details"
        [disabled]="loading() || !personalDetails()"
      >
        <ion-icon name="create-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="profile-details ion-padding">
  @if (loading() || !personalDetails()) {
  <section class="summary-card">
    <div class="icon-badge">
      <ion-skeleton-text
        animated
        style="width: 40px; height: 40px; border-radius: 9999px"
      ></ion-skeleton-text>
    </div>
    <div class="summary">
      <div class="name">
        <ion-skeleton-text
          animated
          style="width: 60%; height: 18px"
        ></ion-skeleton-text>
      </div>
      <div class="meta">
        <ion-skeleton-text
          animated
          style="width: 40%; height: 14px"
        ></ion-skeleton-text>
      </div>
      <div class="meta">
        <ion-skeleton-text
          animated
          style="width: 30%; height: 14px"
        ></ion-skeleton-text>
      </div>
    </div>
  </section>

  <section class="section-card">
    <div class="section-header">
      <h2>
        <ion-skeleton-text
          animated
          style="width: 160px; height: 20px"
        ></ion-skeleton-text>
      </h2>
      <ion-skeleton-text
        animated
        style="width: 24px; height: 24px; border-radius: 6px"
      ></ion-skeleton-text>
    </div>
    <div class="kv">
      @for (i of [1,2,3,4]; track i) {
      <div class="kv-row">
        <div class="kv-label">
          <ion-skeleton-text
            animated
            style="width: 110px; height: 14px"
          ></ion-skeleton-text>
        </div>
        <div class="kv-value">
          <ion-skeleton-text
            animated
            style="width: 50%; height: 14px"
          ></ion-skeleton-text>
        </div>
      </div>
      }
    </div>
  </section>

  <section class="section-card">
    <div class="section-header">
      <h2>
        <ion-skeleton-text
          animated
          style="width: 140px; height: 20px"
        ></ion-skeleton-text>
      </h2>
      <ion-skeleton-text
        animated
        style="width: 24px; height: 24px; border-radius: 6px"
      ></ion-skeleton-text>
    </div>
    <div class="kv">
      @for (i of [1,2,3]; track i) {
      <div class="kv-row">
        <div class="kv-label">
          <ion-skeleton-text
            animated
            style="width: 110px; height: 14px"
          ></ion-skeleton-text>
        </div>
        <div class="kv-value">
          <ion-skeleton-text
            animated
            style="width: 40%; height: 14px"
          ></ion-skeleton-text>
        </div>
      </div>
      }
    </div>
  </section>

  <div class="bottom-spacer" aria-hidden="true"></div>
  } @if (!loading() && personalDetails(); as personalDetails) {

  <section class="summary-card">
    <div class="icon-badge">
      <ion-icon name="person-outline" aria-hidden="true"></ion-icon>
    </div>
    <div class="summary">
      <div class="name">
        {{ personalDetails.firstName }} {{ personalDetails.lastName }}
      </div>
      <div class="meta">
        <ion-icon name="call-outline" aria-hidden="true"></ion-icon>
        <span>{{ personalDetails.phoneNumber }}</span>
      </div>
      @if (personalDetails.sex) {
      <div class="meta">
        <ion-icon name="male-female-outline" aria-hidden="true"></ion-icon>
        <span>{{ personalDetails.sex }}</span>
      </div>
      }
    </div>
  </section>

  <section class="section-card">
    <div class="section-header">
      <h2>Personal details</h2>
      <ion-icon name="person-outline" aria-hidden="true"></ion-icon>
    </div>

    <div class="kv">
      <div class="kv-row">
        <div class="kv-label">First name</div>
        <div class="kv-value">{{ personalDetails.firstName }}</div>
      </div>
      <div class="kv-row">
        <div class="kv-label">Last name</div>
        <div class="kv-value">{{ personalDetails.lastName }}</div>
      </div>
      <div class="kv-row">
        <div class="kv-label">Phone number</div>
        <div class="kv-value">{{ personalDetails.phoneNumber }}</div>
      </div>
      <div class="kv-row">
        <div class="kv-label">Sex</div>
        <div class="kv-value">{{ personalDetails.sex }}</div>
      </div>
    </div>
  </section>

  <section class="section-card">
    <div class="section-header">
      <h2>Bank &amp; Identity</h2>
      <ion-icon name="card-outline" aria-hidden="true"></ion-icon>
    </div>

    <div class="kv">
      <div class="kv-row">
        <div class="kv-label">Bank account</div>
        <div class="kv-value">{{ personalDetails.bankAccountNumber }}</div>
      </div>
      <div class="kv-row">
        <div class="kv-label">Sort code</div>
        <div class="kv-value">{{ personalDetails.bankSortCode }}</div>
      </div>
      <div class="kv-row">
        <div class="kv-label">NI number</div>
        <div class="kv-value">{{ personalDetails.niNumber }}</div>
      </div>
    </div>
  </section>

  <div class="bottom-spacer" aria-hidden="true"></div>
  }
</ion-content>

<ion-modal [isOpen]="isEditOpen()" (didDismiss)="closeEdit()">
  <ng-template>
    <app-profile-edit
      [title]="'Edit personal details'"
      [isPersonalDetails]="true"
      [value]="personalDetails()"
      [loading]="loading()"
      [selectOptions]="{ sex: ['Male','Female','Other'] }"
      (cancel)="closeEdit()"
      (save)="handleSave($event)"
    />
  </ng-template>
</ion-modal>
