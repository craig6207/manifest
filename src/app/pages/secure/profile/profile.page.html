<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Profile</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" color="light" (click)="logout()"
        >Logout</ion-button
      >
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-grid
    class="ion-padding ion-justify-content-center ion-align-items-center full-height"
  >
    <ion-row
      class="ion-justify-content-center ion-align-items-center full-height"
    >
      <ion-col size="12" class="ion-text-center">
        <section class="profile-header ion-padding-bottom">
          <div class="avatar-wrap">
            <ion-avatar>
              <img [src]="avatarSrc()" alt="Profile avatar" />
            </ion-avatar>

            <button
              class="avatar-edit-btn"
              (click)="openAvatarSheet()"
              aria-label="Edit avatar"
            >
              <ion-icon name="camera-outline"></ion-icon>
            </button>
          </div>
          <h3 class="ion-no-margin">{{ displayName() }}</h3>

          @if (rating()! > 0) {
          <app-rating-bar
            [value]="rating()!"
            [max]="5"
            [showText]="true"
            size="md"
          ></app-rating-bar>
          }
        </section>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-footer class="ion-no-border">
  <ion-list lines="full">
    <ion-item
      button
      detail="true"
      [routerLink]="['personal-details']"
      routerDirection="forward"
    >
      <ion-label>Your personal details</ion-label>
    </ion-item>
    <ion-item
      button
      detail="true"
      [routerLink]="['job-preferences']"
      routerDirection="forward"
    >
      <ion-label>Job preferences</ion-label>
    </ion-item>
    <ion-item
      button
      detail="true"
      [routerLink]="['notifications']"
      routerDirection="forward"
    >
      <ion-label>Notifications</ion-label>

      @if (unreadCount() > 0) {
      <ion-badge slot="end" color="danger"> {{ unreadBadgeText() }} </ion-badge>
      }
    </ion-item>
    <ion-item
      button
      detail="true"
      [routerLink]="['about']"
      routerDirection="forward"
    >
      <ion-label>About</ion-label>
    </ion-item>
    <ion-item
      button
      detail="true"
      [routerLink]="['cookies']"
      routerDirection="forward"
    >
      <ion-label>Cookies</ion-label>
    </ion-item>
  </ion-list>
</ion-footer>

<ion-action-sheet
  [isOpen]="isAvatarSheetOpen()"
  (didDismiss)="isAvatarSheetOpen.set(false)"
  header="Change profile photo"
  [buttons]="[
    { text: 'Take photo', icon: 'camera-outline', role: 'camera' },
    { text: 'Choose from library', icon: 'image-outline', role: 'photos' },
    { text: 'Cancel', role: 'cancel' }
  ]"
  (ionActionSheetDidDismiss)="onActionSheetDismiss($event)"
></ion-action-sheet>

<ion-loading [isOpen]="isUploading()" message="Uploading..."></ion-loading>

<ion-toast
  [isOpen]="toastMsg() !== ''"
  [message]="toastMsg()"
  duration="1800"
  (didDismiss)="toastMsg.set('')"
></ion-toast>
