<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/profile"></ion-back-button>
    </ion-buttons>
    <ion-title>Notifications</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
    <ion-refresher-content
      pullingText="Pull to refresh"
    ></ion-refresher-content>
  </ion-refresher>

  <div class="toolbar-sub">
    <ion-segment [value]="filter()" (ionChange)="onFilterChanged($event)">
      <ion-segment-button value="all">All</ion-segment-button>
      <ion-segment-button value="unread">
        Unread @if (unreadCount() > 0) {
        <ion-badge class="seg-badge" color="danger"
          >{{ unreadCount() }}</ion-badge
        >
        }
      </ion-segment-button>
    </ion-segment>
  </div>

  @if (loading()) {
  <ion-list>
    @for (s of [1,2,3,4,5]; track s) {
    <ion-item lines="full">
      <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
      <ion-skeleton-text
        animated
        style="width: 30%"
        slot="end"
      ></ion-skeleton-text>
    </ion-item>
    <ion-item>
      <ion-skeleton-text animated style="width: 95%"></ion-skeleton-text>
    </ion-item>
    }
  </ion-list>
  } @if (showEmpty()) {
  <div class="empty">
    <ion-icon name="notifications-outline"></ion-icon>
    <p>No notifications yet</p>
  </div>
  } @if (!loading() && !showEmpty()) {
  <ion-list inset="true">
    @for (notification of visibleItems(); track notification.id) {
    <ion-item
      button
      detail="true"
      class="notif-item"
      [class.unread]="!notification.isRead"
      (click)="open(notification)"
      lines="full"
    >
      <span class="unread-dot" aria-hidden="true" slot="start"></span>

      <ion-label>
        <h3 class="title">{{ notification.title || notification.type }}</h3>

        <div class="meta">
          @if (!notification.isRead) {
          <ion-icon name="mail-unread-outline"></ion-icon>
          }
          <ion-note
            >{{ toDate(notification.createdAt) | date:'medium' }}</ion-note
          >
        </div>
      </ion-label>
    </ion-item>
    }
  </ion-list>
  }
</ion-content>
