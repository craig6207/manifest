<ion-header>
  <app-toolbar-back
    title="Timesheet edit"
    [calendarShow]="true"
    navigation="/secure/tabs/timesheets"
    (calendarClick)="openWeekPicker()"
  ></app-toolbar-back>

  <div class="week-container">
    <div class="week-pill">
      <ion-button fill="clear" class="week-arrow-btn" (click)="goPrevWeek()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>

      <div class="week-label">{{ weekRangeLabel() }}</div>

      <ion-button fill="clear" class="week-arrow-btn" (click)="goNextWeek()">
        <ion-icon name="arrow-forward-outline"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
    <ion-refresher-content
      pullingText="Pull to refresh"
    ></ion-refresher-content>
  </ion-refresher>

  @if (loading()) {
  <div class="week-container">
    <div class="week-pill">
      <ion-button fill="clear" class="week-arrow-btn" disabled>
        <ion-skeleton-text
          animated
          style="width: 20px; height: 20px"
        ></ion-skeleton-text>
      </ion-button>

      <div class="week-label">
        <ion-skeleton-text
          animated
          style="width: 120px; height: 18px"
        ></ion-skeleton-text>
      </div>

      <ion-button fill="clear" class="week-arrow-btn" disabled>
        <ion-skeleton-text
          animated
          style="width: 20px; height: 20px"
        ></ion-skeleton-text>
      </ion-button>
    </div>
  </div>

  <ion-list inset="true" style="margin-top: 12px">
    @for (i of [1,2,3,4,5,6,7]; track i) {
    <ion-item lines="full">
      <ion-label class="day-label">
        <div class="top">
          <ion-skeleton-text
            animated
            style="width: 90px; height: 16px"
          ></ion-skeleton-text>
        </div>
        <div class="chips" style="margin-top: 8px">
          <ion-chip>
            <ion-skeleton-text
              animated
              style="width: 120px; height: 14px"
            ></ion-skeleton-text>
          </ion-chip>
        </div>
      </ion-label>
      <ion-badge color="primary">
        <ion-skeleton-text
          animated
          style="width: 48px; height: 14px"
        ></ion-skeleton-text>
      </ion-badge>
    </ion-item>
    }
  </ion-list>
  } @else {

  <ion-list inset="true" class="timesheet-list">
    @for (d of days(); track d.dateISO) {
    <ion-item lines="none" class="day-row">
      <div class="day-meta">
        <div class="day-week">{{ d.weekdayShort }}</div>
        <div class="day-day">{{ d.displayDate }}</div>
      </div>

      <div
        class="day-card"
        [class.day-card-empty]="d.entries.length === 0 && weekStatus() === 'Open'"
        [class.day-card-disabled]="d.entries.length === 0 && weekStatus() !== 'Open'"
        (click)="onDayCardClick(d)"
      >
        @if (d.entries.length === 0) { @if (weekStatus() === 'Open') {
        <div class="day-card-main">
          <ion-icon name="add-circle-outline" class="day-card-icon"></ion-icon>
          <span class="day-card-text-primary">Log your time</span>
        </div>
        } @else {
        <div class="day-card-main">
          <span class="day-card-text-muted">No entries</span>
        </div>
        } } @else {
        <div class="day-card-main">
          <ion-icon name="time-outline" class="day-card-icon"></ion-icon>
          <span class="day-card-text-primary">
            {{ d.entries[0].inLabel }} - {{ d.entries[0].outLabel ?? 'â€”' }}
          </span>
        </div>

        @if (d.totalHoursLabel) {
        <div class="day-card-total">{{ d.totalHoursLabel }} logged</div>
        } }
      </div>
    </ion-item>
    }
  </ion-list>

  }
</ion-content>

@if (isWeekPickerOpen()) {
<ion-backdrop
  class="week-backdrop"
  [tappable]="true"
  (click)="closeWeekPicker()"
></ion-backdrop>

<div class="week-picker-sheet">
  <ion-datetime
    presentation="date"
    [value]="selectedDateISO()"
    [min]="minDateISO() ?? undefined"
    [max]="maxDateISO() ?? undefined"
    (ionChange)="onPickerDateChange($event)"
  ></ion-datetime>
</div>
}
