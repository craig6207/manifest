<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="secondary">
      <ion-button id="close-profile" aria-label="Close setup">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-alert
      trigger="close-profile"
      header="Leave profile setup?"
      message="You cannot access the app until you complete the profile setup. You can finish it next time you log in. Still want to leave?"
      [buttons]="alertButtons"
    ></ion-alert>

    <ion-title>Profile Setup</ion-title>
  </ion-toolbar>

  <div class="progress-container ion-padding-horizontal ion-padding-vertical">
    <div class="progress-stack">
      <div class="dots">
        <span [class.active]="currentStep() >= 1">1</span>
        <span [class.active]="currentStep() >= 2">2</span>
        <span [class.active]="currentStep() >= 3">3</span>
      </div>
      <div class="track">
        <div class="fill" [style.width.%]="progress() * 100"></div>
      </div>
    </div>
  </div>
</ion-header>

<ion-content class="setup-content ion-padding">
  @if (currentStep() === 1) {
  <form id="personalForm" [formGroup]="personalForm" (ngSubmit)="next()">
    <section class="section-card form-card">
      <div class="section-header">
        <h2>Personal details</h2>
      </div>

      <ion-list lines="none" class="form-list">
        <ion-item>
          <ion-input
            label="First name"
            labelPlacement="stacked"
            placeholder="First name"
            formControlName="firstName"
            required
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="Surname"
            labelPlacement="stacked"
            placeholder="Surname"
            formControlName="lastName"
            required
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="Phone number"
            labelPlacement="stacked"
            type="tel"
            placeholder="0700 111 2222"
            formControlName="phoneNumber"
            required
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-select
            label="Sex"
            labelPlacement="stacked"
            formControlName="sex"
            interface="popover"
            justify="start"
          >
            <ion-select-option value="Male">Male</ion-select-option>
            <ion-select-option value="Female">Female</ion-select-option>
            <ion-select-option value="Other">Other</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </section>
  </form>
  } @if (currentStep() === 2) {
  <form id="locationForm" [formGroup]="locationForm" (ngSubmit)="next()">
    <section class="section-card form-card">
      <div class="section-header">
        <h2>Location &amp; pay</h2>
      </div>

      <ion-list lines="none" class="form-list">
        <ion-item>
          <ion-input
            label="Location"
            labelPlacement="stacked"
            placeholder="e.g. EH8 7PB"
            formControlName="location"
          ></ion-input>
        </ion-item>

        <ion-item class="range-item">
          <div class="range-header">
            <ion-label>Distance radius </ion-label>
            <ion-note slot="end">
              {{ locationForm.get('locationRadius')?.value }} miles
            </ion-note>
          </div>
          <ion-range
            formControlName="locationRadius"
            min="5"
            max="100"
            step="5"
            snaps
          ></ion-range>
        </ion-item>

        <ion-item class="range-item">
          <div class="range-header">
            <ion-label>Pay expectation </ion-label>
            <ion-note slot="end">
              Â£{{ locationForm.get('expectedPay')?.value }} / h
            </ion-note>
          </div>
          <ion-range
            aria-label="Pay Expectation"
            formControlName="expectedPay"
            min="5"
            max="100"
            step="1"
          ></ion-range>
        </ion-item>
      </ion-list>
    </section>

    <section class="section-card form-card">
      <div class="section-header">
        <h2>Trade</h2>
      </div>

      <ion-list lines="none" class="form-list">
        <ion-item>
          <ion-select
            label="Trade category"
            labelPlacement="stacked"
            formControlName="tradeCategory"
            interface="popover"
            justify="start"
          >
            @for (cat of tradeCategoryOptions; track cat) {
            <ion-select-option [value]="cat">{{ cat }}</ion-select-option>
            }
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-select
            label="Trade sub-category"
            labelPlacement="stacked"
            formControlName="tradeSubcategory"
            interface="popover"
            justify="start"
          >
            @for (sub of subcategoryOptions; track sub) {
            <ion-select-option [value]="sub">{{ sub }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
      </ion-list>
    </section>
  </form>
  } @if (currentStep() === 3) {
  <form id="bankForm" [formGroup]="bankForm" (ngSubmit)="submit()">
    <section class="section-card form-card">
      <div class="section-header">
        <h2>Payment details</h2>
      </div>

      <ion-list lines="none" class="form-list">
        <ion-item>
          <ion-input
            label="Bank account number"
            labelPlacement="stacked"
            placeholder="Account number"
            formControlName="bankAccountNumber"
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="Sort code"
            labelPlacement="stacked"
            placeholder="Sort code"
            formControlName="bankSortCode"
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="NI number"
            labelPlacement="stacked"
            placeholder="NI number"
            formControlName="niNumber"
          ></ion-input>
        </ion-item>
      </ion-list>
    </section>
  </form>
  }
  <div class="bottom-spacer" aria-hidden="true"></div>
</ion-content>

<ion-footer>
  <ion-toolbar class="cta-toolbar">
    @if (currentStep() === 1) {
    <ion-button
      expand="block"
      class="primary-btn"
      [disabled]="personalForm.invalid"
      (click)="next()"
    >
      Next
    </ion-button>
    } @else if (currentStep() === 2) {
    <div class="cta-row">
      <ion-button
        class="ghost-btn"
        fill="outline"
        color="primary"
        (click)="back()"
      >
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Back
      </ion-button>
      <ion-button
        class="primary-btn"
        (click)="next()"
        [disabled]="locationForm.invalid"
      >
        Next
      </ion-button>
    </div>
    } @else if (currentStep() === 3) {
    <div class="cta-row">
      <ion-button
        class="ghost-btn"
        fill="outline"
        color="primary"
        (click)="back()"
      >
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Back
      </ion-button>
      <ion-button
        class="primary-btn"
        [disabled]="bankForm.invalid"
        (click)="submit()"
      >
        Submit
      </ion-button>
    </div>
    }
  </ion-toolbar>
</ion-footer>
