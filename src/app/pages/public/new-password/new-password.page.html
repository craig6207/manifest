<ion-header>
  <ion-toolbar color="primary" class="ion-no-border">
    <ion-buttons slot="start">
      <ion-back-button
        text="Back"
        defaultHref="/login"
        aria-label="Go back to login"
      ></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="auth-content">
  <section class="hero ion-padding-horizontal">
    <ion-img
      class="logo ion-padding-bottom"
      src="/assets/img/Recruut_logo.svg"
      alt="WeRecruit logo"
    ></ion-img>

    <p class="subtitle">Set a new password</p>
    <p class="ion-text-center ion-padding-top">
      Your password must be at least 9 characters and include upper, lower, and
      a number.
    </p>
  </section>

  <section class="auth-card ion-padding">
    <form
      class="form-default"
      [formGroup]="form"
      (ngSubmit)="submit()"
      novalidate
    >
      <ion-list lines="none" class="form-list">
        <ion-item class="field">
          <ion-input
            #newPwdInput
            label="New password"
            labelPlacement="stacked"
            formControlName="newPassword"
            type="password"
            autocomplete="new-password"
            placeholder="Enter a strong password"
          >
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
        </ion-item>
        <div class="strength">
          <ion-progress-bar
            [value]="strengthValue()"
            [color]="strengthColor()"
          ></ion-progress-bar>
          <div class="strength-label">
            @if (strengthColor() === 'danger') { Weak } @else if
            (strengthColor() === 'warning') { Medium } @else { Strong }
          </div>
        </div>

        <ul class="criteria">
          <li [class.ok]="hasLen()">At least 9 characters</li>
          <li [class.ok]="hasUpper()">Contains an uppercase letter</li>
          <li [class.ok]="hasLower()">Contains a lowercase letter</li>
          <li [class.ok]="hasDigit()">Contains a number</li>
        </ul>

        @if (newPasswordInvalid) {
        <div class="error">Please meet all password requirements.</div>
        }

        <ion-item class="field ion-margin-top">
          <ion-input
            label="Repeat password"
            labelPlacement="stacked"
            formControlName="repeatPassword"
            type="password"
            autocomplete="new-password"
            placeholder="Repeat new password"
          >
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
        </ion-item>

        @if (repeatInvalid) {
        <div class="error">Passwords must match.</div>
        }
      </ion-list>

      <ion-button
        class="primary-btn ion-margin-top"
        type="submit"
        expand="block"
        color="primary"
        [disabled]="form.invalid || isLoading"
        aria-label="Save new password"
      >
        Save password
      </ion-button>
    </form>
  </section>

  <ion-toast
    [isOpen]="toastOption.show"
    position="top"
    [color]="toastOption.color"
    [message]="toastOption.message"
    duration="3000"
    keyboardClose="true"
    (didDismiss)="setToast()"
  >
  </ion-toast>

  <div class="copyright ion-text-center">
    <ion-text color="medium">
      <small>&copy; 2025 WeRecruit</small>
    </ion-text>
  </div>
</ion-content>
