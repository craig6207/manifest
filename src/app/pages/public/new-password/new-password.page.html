<ion-header no-shadow>
  <app-toolbar-back
    title="Create new password"
    navigation="/login"
  ></app-toolbar-back>
</ion-header>

<ion-content class="new-password-page">
  <section class="form-card">
    <form class="form-default" [formGroup]="form" novalidate>
      <ion-list lines="none" class="form-list ion-margin">
        <label class="field-label ion-padding" for="newPassword"
          >New password</label
        >
        <ion-item class="input-item ion-margin-bottom">
          <ion-input
            formControlName="newPassword"
            [type]="showPassword ? 'text' : 'password'"
            placeholder="Enter password"
            autocomplete="new-password"
          >
          </ion-input>
          <ion-button
            slot="end"
            fill="clear"
            size="small"
            class="field-icon-btn"
            type="button"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
          >
            <ion-icon
              [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
              slot="icon-only"
            ></ion-icon>
          </ion-button>
        </ion-item>

        @if (form.get('newPassword')!.invalid &&
        (form.get('newPassword')!.touched)) { @if
        (form.get('newPassword')!.errors?.['strongPassword']) {
        <div class="error">
          Password must be at least 9 characters and include upper, lower, and a
          number.
        </div>
        } }

        <label class="field-label ion-padding" for="repeatPassword"
          >Confirm password</label
        >

        <ion-item class="input-item ion-margin-bottom">
          <ion-input
            formControlName="repeatPassword"
            [type]="showRepeatPassword ? 'text' : 'password'"
            placeholder="Confirm password"
            autocomplete="new-password"
          >
          </ion-input>
          <ion-button
            slot="end"
            fill="clear"
            size="small"
            class="field-icon-btn"
            type="button"
            (click)="toggleRepeatPasswordVisibility()"
            [attr.aria-label]="showRepeatPassword ? 'Hide password' : 'Show password'"
          >
            <ion-icon
              [name]="showRepeatPassword ? 'eye-off-outline' : 'eye-outline'"
              slot="icon-only"
            ></ion-icon>
          </ion-button>
        </ion-item>

        @if (form.get('repeatPassword')!.invalid &&
        (form.get('repeatPassword')!.touched)) { @if
        (form.get('repeatPassword')!.errors?.['required']) {
        <div class="error">Please repeat your password.</div>
        } }
      </ion-list>
    </form>
  </section>
</ion-content>
<ion-footer class="ion-no-border ion-padding">
  <ion-button
    expand="block"
    color="primary"
    [disabled]="form.invalid || isLoading"
    (click)="submit()"
    aria-label="Submit new password"
  >
    Submit
  </ion-button>
</ion-footer>

<ion-toast
  [isOpen]="toastOption.show"
  position="top"
  [color]="toastOption.color"
  [message]="toastOption.message"
  duration="3000"
  keyboardClose="true"
  (didDismiss)="setToast()"
></ion-toast>
