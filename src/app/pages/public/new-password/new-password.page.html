<ion-content [fullscreen]="true" class="new-password-page">
  <div class="page-inner">
    <section class="hero">
      <div class="hero-top">
        <ion-button
          fill="clear"
          size="small"
          class="back-btn"
          (click)="goBack()"
          aria-label="Back to login"
        >
          <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </div>

      <img
        class="hero-logo"
        src="/assets/img/Recruut_logo.svg"
        alt="WeRecruit logo"
      />

      <h1 class="hero-title">Set a new password</h1>
      <p class="hero-subtitle">
        Your password must be at least 9 characters and include upper, lower,
        and a number.
      </p>
    </section>
    <section class="form-card">
      <form
        class="form-default"
        [formGroup]="form"
        (ngSubmit)="submit()"
        novalidate
      >
        <ion-list lines="none" class="form-list">
          <ion-item class="input-item">
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-input
              #newPwdInput
              formControlName="newPassword"
              type="password"
              autocomplete="new-password"
              placeholder="New password"
            >
              <ion-input-password-toggle slot="end"></ion-input-password-toggle>
            </ion-input>
          </ion-item>

          <div class="strength">
            <ion-progress-bar
              [value]="strengthValue()"
              [color]="strengthColor()"
            ></ion-progress-bar>
            <div class="strength-label">
              @if (strengthColor() === 'danger') { Weak } @else if
              (strengthColor() === 'warning') { Medium } @else { Strong }
            </div>
          </div>
          <ul class="criteria">
            <li [class.ok]="hasLen()">At least 9 characters</li>
            <li [class.ok]="hasUpper()">Contains an uppercase letter</li>
            <li [class.ok]="hasLower()">Contains a lowercase letter</li>
            <li [class.ok]="hasDigit()">Contains a number</li>
          </ul>

          @if (newPasswordInvalid) {
          <div class="error">Please meet all password requirements.</div>
          }
          <ion-item class="input-item ion-margin-top">
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-input
              formControlName="repeatPassword"
              type="password"
              autocomplete="new-password"
              placeholder="Repeat new password"
            >
              <ion-input-password-toggle slot="end"></ion-input-password-toggle>
            </ion-input>
          </ion-item>

          @if (repeatInvalid) {
          <div class="error">Passwords must match.</div>
          }
        </ion-list>
        <ion-button
          class="primary-btn"
          type="submit"
          expand="block"
          [disabled]="form.invalid || isLoading"
          aria-label="Save new password"
        >
          Save password
        </ion-button>
      </form>

      <ion-toast
        [isOpen]="toastOption.show"
        position="top"
        [color]="toastOption.color"
        [message]="toastOption.message"
        duration="3000"
        keyboardClose="true"
        (didDismiss)="setToast()"
      >
      </ion-toast>
    </section>
  </div>
</ion-content>
