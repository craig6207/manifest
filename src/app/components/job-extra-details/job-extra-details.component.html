<ion-header>
  <app-toolbar-back [title]="title()"></app-toolbar-back>
</ion-header>

<ion-content [fullscreen]="true" class="job-extra-page">
  @if (loading()) {
  <div class="details-inner">
    @for (i of [1, 2, 3]; track i) {
    <section class="summary-card skeleton-card">
      <div class="icon-badge">
        <ion-skeleton-text
          animated
          style="width: 24px; height: 24px; border-radius: 9999px"
        ></ion-skeleton-text>
      </div>
      <div class="summary">
        <div class="name">
          <ion-skeleton-text
            animated
            style="width: 50%; height: 16px"
          ></ion-skeleton-text>
        </div>
        <div class="meta">
          <ion-skeleton-text
            animated
            style="width: 80%; height: 14px"
          ></ion-skeleton-text>
        </div>
        <div class="meta">
          <ion-skeleton-text
            animated
            style="width: 60%; height: 14px"
          ></ion-skeleton-text>
        </div>
      </div>
    </section>
    }
    <div class="bottom-spacer" aria-hidden="true"></div>
  </div>
  } @if (!loading() && error()) {
  <div class="details-inner">
    <div class="error">{{ error() }}</div>
  </div>
  } @if (!loading() && !error() && details()) {
  <div class="details-inner">
    <section class="summary-card">
      <div class="icon-badge">
        <ion-icon name="location-outline"></ion-icon>
      </div>
      <div class="summary">
        <div class="name">Site details</div>
        @if (addressLine()) {
        <div class="meta">
          {{ addressLine() }}
        </div>
        } @if (hoursText()) {
        <div class="meta">Working hours · {{ hoursText() }}</div>
        }
      </div>
    </section>

    <section class="summary-card">
      <div class="icon-badge">
        <ion-icon name="person-outline"></ion-icon>
      </div>
      <div class="summary">
        <div class="name">Key information</div>

        @if (details()?.siteContact) {
        <div class="field-block">
          <div class="field-label">Main contact</div>
          <div class="value">
            {{ details()?.siteContact?.name }}
            @if (details()?.siteContact?.phone) {
            <ng-container> · {{ details()?.siteContact?.phone }} </ng-container>
            }
          </div>
          @if (details()?.siteContact?.email) {
          <ion-note>{{ details()?.siteContact?.email }}</ion-note>
          }
        </div>
        } @if (ppeChips().length) {
        <div class="field-block">
          <div class="field-label">PPE</div>
          <div class="chip-row">
            @for (p of ppeChips(); track p) {
            <span class="pill">{{ p }}</span>
            }
          </div>
        </div>
        }
      </div>
    </section>

    @if (details()?.siteAddress?.notes) {
    <section class="summary-card">
      <div class="icon-badge">
        <ion-icon name="document-text-outline"></ion-icon>
      </div>
      <div class="summary">
        <div class="name">Site notes</div>
        <p class="project-notes">
          {{ details()?.siteAddress?.notes }}
        </p>
      </div>
    </section>
    }

    <div class="bottom-spacer" aria-hidden="true"></div>
  </div>
  }
</ion-content>

<ion-footer style="background-color: #f4f8fb" class="ion-padding ion-no-border">
  <ion-toolbar>
    <div class="btns">
      <ion-button
        expand="block"
        color="primary"
        [disabled]="actioning()"
        (click)="confirm()"
      >
        Confirm
      </ion-button>

      <ion-button
        expand="block"
        color="danger"
        fill="outline"
        [disabled]="actioning()"
        (click)="decline()"
      >
        Decline
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
